# App Builder Expressions

Expression syntax reference for dynamic content

---

App Builder is experimental. Expression syntax may change.

## Overview

Expressions use `{{ }}` syntax to inject dynamic values into component properties. They enable:

- Displaying user data
- Accessing workflow results
- Reading form field values
- Conditional logic for visibility/disabled states
- Dynamic navigation paths

## Syntax

### Single Expression

Returns the raw value (string, number, boolean, object):

```javascript
{{ user.name }}           // "John"
{{ variables.count }}     // 42
{{ user.role == 'admin' }} // true
{{ data.items }}          // [...]
```

### Template Interpolation

Text with embedded expressions returns a string:

```javascript
"Hello, {{ user.name }}!"           // "Hello, John!"
"Items: {{ variables.count }}"      // "Items: 42"
"/users/{{ row.id }}/edit"          // "/users/abc123/edit"
```

## Context Variables

Expressions have access to these context variables:

### user

Current authenticated user:

```javascript
{{ user.id }}       // User UUID
{{ user.name }}     // Display name
{{ user.email }}    // Email address
{{ user.role }}     // Role string
```

### variables

Page-level mutable state:

```javascript
{{ variables.selectedId }}
{{ variables.filterText }}
{{ variables.currentTab }}
```

Set variables using the `set-variable` action.

### workflow

Access workflow results by their data source ID. This is the recommended way to access data loaded by `launchWorkflowId`:

```javascript
{{ workflow.customers.result }}           // Array from workflow with dataSourceId "customers"
{{ workflow.stats.result.totalRevenue }}  // Nested property from stats workflow
{{ workflow.customers.result.0.name }}    // Array index access

// Workflow execution state
{{ workflow.customers.status }}           // "pending" | "running" | "completed" | "failed"
{{ workflow.customers.executionId }}      // UUID of the execution
{{ workflow.customers.error }}            // Error message if failed
```

**Recommended Pattern**: When using `launchWorkflowId` with `launchWorkflowDataSourceId`, access results via `{{ workflow.<dataSourceId>.result }}`. For example, if `launchWorkflowDataSourceId: "stats"`, use `{{ workflow.stats.result.revenue }}`.

### data (Legacy)

**DEPRECATED**: The `data` context is deprecated. Use `{{ workflow.<key>.result }}` instead. The `data` context is maintained for backwards compatibility with apps using the legacy `dataSources` array.

Data from legacy page data sources:

```javascript
{{ data.customers }}           // Array from "customers" data source
{{ data.stats.totalRevenue }}  // Nested property
{{ data.users.0.name }}        // Array index access
```

### field

Form input values (by fieldId):

```javascript
{{ field.customerName }}
{{ field.quantity }}
{{ field.isActive }}
```

### row (DataTable only)

Current row in table actions:

```javascript
{{ row.id }}
{{ row.name }}
{{ row.user.email }}    // Nested property
```

The `row` context is only available in `rowActions` within a DataTable component.

## Operators

### Comparison

```javascript
{{ user.role == 'admin' }}      // Equals
{{ user.role === 'admin' }}     // Strict equals
{{ user.role != 'admin' }}      // Not equals
{{ user.role !== 'admin' }}     // Strict not equals
{{ variables.count > 10 }}      // Greater than
{{ variables.count >= 10 }}     // Greater than or equal
{{ variables.count < 10 }}      // Less than
{{ variables.count <= 10 }}     // Less than or equal
```

### Logical

```javascript
{{ user.isActive && user.isVerified }}  // AND
{{ user.isAdmin || user.isManager }}    // OR
{{ !user.isBlocked }}                   // NOT
```

### Parentheses

```javascript
{{ (user.role == 'admin' || user.role == 'manager') && user.isActive }}
```

## Literals

```javascript
{{ true }}
{{ false }}
{{ null }}
{{ undefined }}
{{ 42 }}
{{ 3.14 }}
{{ 'single quotes' }}
{{ "double quotes" }}
```

## Property Access

### Dot Notation

```javascript
{{ user.profile.name }}
{{ data.orders.0.items.0.name }}
```

### Nested Objects

Access deeply nested data safely:

```javascript
{{ data.customer.address.city }}    // Returns undefined if any level is missing
{{ workflow.result.data.id }}
```

## Common Patterns

### Conditional Visibility

Show component only for admins:

```json
{
  "type": "button",
  "visible": "{{ user.role == 'admin' }}",
  "props": { "label": "Admin Action" }
}
```

### Conditional Disable

Disable button while workflow runs:

```json
{
  "type": "button",
  "props": {
    "label": "Submit",
    "disabled": "{{ workflow.status == 'running' }}"
  }
}
```

Disable based on form state:

```json
{
  "type": "button",
  "props": {
    "label": "Save",
    "disabled": "{{ !field.name || !field.email }}"
  }
}
```

### Dynamic Navigation

Navigate with row data:

```json
{
  "onClick": {
    "type": "navigate",
    "navigateTo": "/customers/{{ row.id }}"
  }
}
```

Navigate with variables:

```json
{
  "onClick": {
    "type": "navigate",
    "navigateTo": "/search?q={{ variables.searchTerm }}"
  }
}
```

### Workflow Parameters

Pass expressions to workflows:

```json
{
  "actionType": "workflow",
  "workflowId": "update_customer",
  "actionParams": {
    "id": "{{ variables.customerId }}",
    "name": "{{ field.customerName }}",
    "email": "{{ field.customerEmail }}"
  }
}
```

### Display Computed Values

Template interpolation:

```json
{
  "type": "text",
  "props": {
    "text": "Welcome back, {{ user.name }}! You have {{ data.notifications.length }} new notifications."
  }
}
```

### Badge Colors by Status

```json
{
  "type": "data-table",
  "props": {
    "columns": [
      {
        "key": "status",
        "header": "Status",
        "type": "badge",
        "badgeColors": {
          "active": "green",
          "pending": "yellow",
          "inactive": "gray"
        }
      }
    ]
  }
}
```

### Conditional Row Actions

Show action only for certain rows:

```json
{
  "rowActions": [
    {
      "label": "Approve",
      "visible": "{{ row.status == 'pending' }}",
      "onClick": {
        "type": "workflow",
        "workflowId": "approve_item"
      }
    }
  ]
}
```

Disable action for locked rows:

```json
{
  "rowActions": [
    {
      "label": "Delete",
      "disabled": "{{ row.isLocked || row.status == 'active' }}",
      "onClick": { "type": "workflow", "workflowId": "delete_item" }
    }
  ]
}
```

### OnComplete Variable Setting

Save workflow result to variable:

```json
{
  "onComplete": [
    {
      "type": "set-variable",
      "variableName": "lastResult",
      "variableValue": "{{ workflow.result }}"
    }
  ]
}
```

## Evaluation Rules

### Type Coercion

- Expressions in boolean contexts (`visible`, `disabled`) are coerced to boolean
- Empty strings, `null`, `undefined`, `0` are falsy
- Non-empty strings, objects, arrays, non-zero numbers are truthy

### Undefined Handling

- Accessing undefined properties returns `undefined`
- `undefined` in templates renders as empty string
- `undefined` in comparisons should use explicit checks

```javascript
// Safe pattern for optional values
{{ user.middleName || '' }}
{{ variables.count || 0 }}
```

### Array Access

```javascript
{{ data.items.0 }}         // First item
{{ data.items.0.name }}    // First item's name property
```

## Limitations

Expressions do **not** support:

- Function calls (`{{ items.filter(...) }}`)
- Complex arithmetic beyond comparisons
- Array methods (`map`, `filter`, `reduce`)
- String methods (`toLowerCase()`, `split()`)
- Ternary operators (`{{ x ? y : z }}`) - use logical OR instead
- Object destructuring

For complex transformations, compute values in your workflow and return them in the result.

## Debugging

If expressions don't evaluate as expected:

1. Check property names match exactly (case-sensitive)
2. Verify data source is loaded before component renders
3. Check for typos in context variable names (`user` not `users`)
4. Use browser dev tools to inspect rendered values